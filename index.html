
<!DOCTYPE HTML>
<!--
    Identity by HTML5 UP
    html5up.net | @n33co
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<header>
    <title>Discover South Sudan</title></br>

    <center><strong><font size="5" font face="arial">Discover South Sudan</font></strong></br>
    Data shown is from <a href="http://workflow.isi.edu/MINT/results/20180722/">http://workflow.isi.edu/MINT/results/20180722/baseline/</a> and <a href="http://climis-southsudan.org">http://climis-southsudan.org</a></center></br></br>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- load script libraries -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
</header>

<body class="is-loading">
  <!-- Sets up containers for each chart and one container that combines all charts for synchronization -->
  <div id="syncChart" style="width: 100%; margin-left: auto; margin-right: auto">
      <div id="Chart1" style="width: 100%;height: 190px; margin-left: auto; margin-right: auto"></div>
      <div id="Chart2" style="width: 100%;height: 190px; margin-left: auto; margin-right: auto"></div>
      <div id="Chart3" style="width: 100%;height: 190px; margin-left: auto; margin-right: auto"></div>
      <div id="Chart4" style="width: 100%;height: 190px; margin-left: auto; margin-right: auto"></div>
  </div>
</head>

<body>
<script>
  $(function() {
    /**
     * In order to synchronize tooltips and crosshairs, override the
     * built-in events with handlers defined on the parent element.
     * (Modified from Highcharts API documentation to add indexing for JSON arrays)
     **/
    $('#syncChart>div').bind('mousemove touchmove touchstart', function(e) {
        var chart,
            point,
            index, // Indexes data so that the arrays all have the same positions starting at 0, which
            i, // fixed the problem with the data being misaligned even though the crosshairs were synced.
            event;
        chart = $(this).highcharts()
        event = chart.pointer.normalize(e.originalEvent);

        //Find events within the charts
        point = chart.series[0].searchPoint(event, true);
        if (point) {
            index = point.index
            for (i = 0; i < Highcharts.charts.length; i = i + 1) {
                chart = Highcharts.charts[i];
                point = chart.series[0].points[index]
                if (point) {
                    point.highlight(e);
                }
            }
        }
    });

    /**
     * Override the reset function, we don't need to hide the tooltips and crosshairs.
     **/
    Highcharts.Pointer.prototype.reset = function() {
        return undefined;
    };

    /**
     * Highlight a point by showing tooltip, setting hover state and draw crosshair
     **/
    Highcharts.Point.prototype.highlight = function(event) {
        this.onMouseOver(); // Show the hover marker
        // this.series.chart.tooltip.refresh(this); // Show the tooltip, this breaks when more than one series is added per plot (more than one series is sharing the tooltip)
        this.series.chart.xAxis[0].drawCrosshair(event, this); // Show the crosshair
    };

    /**
     * Synchronize through the setExtremes event handler.
     **/
    function syncExtremes(e) {
        var thisChart = this.chart;

        if (e.trigger !== 'syncExtremes') { // Prevent feedback loop
            Highcharts.each(Highcharts.charts, function(chart) {
                if (chart !== thisChart) {
                    if (chart.xAxis[0].setExtremes) { // It is null while updating
                        chart.xAxis[0].setExtremes(e.min, e.max, true, true, {
                            trigger: 'syncExtremes'
                        });
                    }
                }
            });
        }
    };


    /**
     * Chart1
     **/
    $.getJSON("MINT_Sorghum_Production_Baseline.json").done(function(rawData) {
        var data = []
        $.each(rawData, function(index, item) {
            data.push([Date.UTC(item[0],item[1],item[2]),item[3]])
        })
        Highcharts.chart('Chart1', {
            chart: {
                zoomType: 'x'
            },
            title: {
                text: 'Crop Production'
            },
            subtitle: {
                text: 'MINT Workflow Output'  // source of data
            },
            xAxis: {
                type: 'datetime',
                crosshair: true,
                showFirstLabel: true,
                showLastLabel: true,
                tickPosition: 'inside',
                labels: {
                    style: {
                        fontSize: '12px'
                    }
                },
            },
            yAxis: {
                title: {
                    text: 'Mkg',    // units
                    style: {
                        fontSize: '11px'
                    },
                },
                min: 0,
                max: 800,
                tickInterval: 400   // helps force y-axis scaling to better fit data when the automatic styling doesn't fit right
            },
            tooltip: {
                positioner: function() {
                    return {
                        x: this.chart.chartWidth - this.label.width - 10, // right aligned
                        y: 5
                    };
                    relativeTo: 'Chart1'
                },
                shared: true,
                valueDecimals: 1,
            },
            credits: {
                enabled: false
            },
            legend: {
                enabled: false
            },
            series: [{
                name: 'MINT Sorghum Production',
                data: data,   // data variable name must match how it is declared with the jQuery request
                lineWidth: 1,
                color: '#18770b'  // green
            }],
        });
    })  // end Chart1


    /**
     * Chart2
     **/
    $.getJSON("CLIMIS_WFPwhiteSorghum_Malawa35kg_Juba_2012-2017.json").done(function(rawData) {
        var data = []
        $.each(rawData, function(index, item) {
            data.push([Date.UTC(item[0],item[1],item[2]),item[3]])
        })
        $.getJSON("CLIMIS_WFPmaize_Malawa35kg_Juba_2012-2017.json").done(function(rawData) {
            var data1 = []
            $.each(rawData, function(index, item) {
                data1.push([Date.UTC(item[0],item[1],item[2]),item[3]])
            })
            $.getJSON("CLIMIS_WFPchickpea_Malawa35kg_Juba_2012-2017.json").done(function(rawData) {
                var data2 = []
                $.each(rawData, function(index, item) {
                    data2.push([Date.UTC(item[0],item[1],item[2]),item[3]])
                })
        Highcharts.chart('Chart2', {
            chart: {
                zoomType: 'x'
            },
            title: {
                text: 'Crop Price'
            },
            subtitle: {
                text: 'CLIMIS Database'
            },
            xAxis: {
                type: 'datetime',
                crosshair: true,
                showFirstLabel: true,
                showLastLabel: true,
                tickPosition: 'inside',
                labels: {
                    style: {
                        fontSize: '12px'
                    }
                },
            },
            yAxis: {
                title: {
                    text: 'Malawa 3.5kg',
                    style: {
                        fontSize: '11px'
                    },
                },
                min: 0,
                max: 1000,
                tickInterval: 500   // helps force y-axis scaling to better fit data when the automatic styling doesn't fit right
            },
            tooltip: {
                positioner: function() {
                    return {
                        x: this.chart.chartWidth - this.label.width - 10, // right aligned
                        y: 5
                    };
                    relativeTo: 'Chart2'
                },
                shared: true,
                valueDecimals: 1
            },
            credits: {
                enabled: false
            },
            legend: {
                enabled: false
            },
            series: [{
                name: 'White Sorghum',
                data: data,
                lineWidth: 1,
                color: '#a84800',  // brown
                fillOpacity: 0.4
            },{
                name: 'Maize',
                data: data1,
                lineWidth: 1,
                color: '#efcf00',   // gold
                fillOpacity: 0.4
            },{
                name: 'Peanut',
                data: data2,
                lineWidth: 1,
                color: '#a8124e',   // fuschia
                fillOpacity: 0.4
            }],
        });
    })
    })
    })  //end Chart2


    /**
     * Chart3
     **/
    $.getJSON("CYCLESsorghum_BaselinePrecipitation.json").done(function(rawData) {
        var data = []
        $.each(rawData, function(index, item) {
            data.push([Date.UTC(item[0],item[1],item[2]),item[3]])
        })
        Highcharts.chart('Chart3', {
            title: {
                text: 'Precipitation'
            },
            subtitle: {
                text: 'CYCLES Model Output'
            },
            chart: {
                type: 'column',
                zoomType: 'x'
            },
            xAxis: {
                type: 'datetime',
                title: {
                    text: 'Date',
                    style: {
                        fontSize: '12px'
                    },
                },
                crosshair: true,
                showFirstLabel: true,
                showLastLabel: true,
                tickPosition: 'inside',

                labels: {
                    style: {
                        fontSize: '12px'
                    }
                },
            },
            yAxis: {
                title: {
                    text: 'mm',
                    style: {
                        fontSize: '12px'
                    },
                },
            },
            credits: {
                enabled: false
            },
            legend: {
                enabled: false
            },
            tooltip: {
                positioner: function() {
                    return {
                        x: this.chart.chartWidth - this.label.width - 10, // right aligned
                        y: 5
                    };
                    relativeTo: 'Chart3'
                },
                shared: true,
                valueDecimals: 1
            },
            series: [{
                name: 'Precipitation',
                data: data,
                lineWidth: 1,
                color: '#0e9ba0'  // teal
            }],
        });
    })  // end Chart3


    /**
     * Chart4
     **/
    $.getJSON("CYCLESsorghum_BaselineAvgTemp.json").done(function(rawData) {
        var data = []

        $.each(rawData, function(index, item) {
            data.push([Date.UTC(item[0],item[1],item[2]),item[3]])
        })
        Highcharts.chart('Chart4', {
            chart: {
                zoomType: 'x'
            },
            title: {
                text: 'Average Temperature'
            },
            subtitle: {
                text: 'CYCLES Model Output'
            },
            xAxis: {
                type: 'datetime',
                crosshair: true,
                showFirstLabel: true,
                showLastLabel: true,
                tickPosition: 'inside',
                labels: {
                    style: {
                        fontSize: '12px'
                    }
                },
            },
            yAxis: {
                title: {
                    text: 'Degrees Celcius',
                    style: {
                        fontSize: '11px'
                    },
                },
            },
            tooltip: {
                positioner: function() {
                    return {
                        x: this.chart.chartWidth - this.label.width - 10, // right aligned
                        y: 5
                    };
                    relativeTo: 'Chart4'
                },
                shared: true,
                valueDecimals: 1
            },
            legend: {
                enabled: false
            },
            // credits: {   // show credits on last chart, can add text like MINT Project copyright info or something of the like
            //     enabled: false
            // },
            series: [{
                name: 'Temperature',
                data: data,
                lineWidth: 1,
                color: '#f46b42'  // orangered
            }],
        });
    })  // end Chart4

});   // end Synchronize chart
</script>

</body>
</html>
